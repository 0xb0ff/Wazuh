<group name="auditd,interpreters,download_and_exec,">

  <!-- Base: Python executed -->
  <rule id="110420" level="5">
    <if_group>audit</if_group>
    <match>python-exec</match>
    <description>Python interpreter executed</description>
    <group>execution,</group>
  </rule>

  <!-- Base: Perl executed -->
  <rule id="110421" level="5">
    <if_group>audit</if_group>
    <field name="audit.uid">!=0</field>
    <match>perl-exec</match>
    <description>Perl interpreter executed</description>
    <group>execution,</group>
  </rule>

  <!-- Escalation: Python/Perl piping to a shell (rare, high-risk) -->
  <rule id="110422" level="15">
    <if_sid>110420,110421</if_sid>
    <regex>\|\s*(/bin/)?sh|\|\s*(/bin/)?bash</regex>
    <description>High-risk behavior: interpreter output piped into a shell (python/perl | sh/bash)</description>
    <group>attack,execution,</group>
  </rule>

  <!-- Escalation: Python/Perl inline code that fetches remote content -->
  <rule id="110423" level="15">
    <if_sid>110420,110421</if_sid>
    <regex>-c\s|urllib|requests|http\.client|socket|ftplib|LWP::Simple|HTTP::Tiny|IO::Socket|wget|curl</regex>
    <description>High-risk behavior: interpreter inline/network fetch patterns (possible download & execute)</description>
    <group>attack,execution,</group>
  </rule>

</group>

<group name="auditd,python,perl,network,reverse_shell,">

  <!-- Base: python/perl initiated connect() -->
  <rule id="110430" level="14">
    <if_group>audit</if_group>
    <field name="audit.uid">!=0</field>
    <match>pyperl-net-connect</match>
    <description>High-risk: Python/Perl initiated a network connection (connect syscall) - possible reverse shell/C2</description>
    <group>attack,reverse_shell,network,</group>
  </rule>

  <!-- Boost: typical reverse shell tokens in inline payloads -->
  <rule id="110431" level="15">
    <if_sid>110430</if_sid>
    <field name="audit.uid">!=0</field>
    <regex>exec\s*\(\s*["']sh|exec\s*\(\s*["']/bin/sh|exec\s*\(\s*["']bash|open\s*\(\s*STDIN|open\s*\(\s*STDOUT|open\s*\(\s*STDERR|IO::Socket|Socket|sockaddr_in|inet_aton</regex>
    <description>Critical: Python/Perl reverse shell pattern (exec shell and/or stdio redirection) after connect()</description>
    <group>attack,reverse_shell,critical,</group>
  </rule>

</group>
